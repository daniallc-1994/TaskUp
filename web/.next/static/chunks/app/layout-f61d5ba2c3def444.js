(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1559:function(t,e,n){Promise.resolve().then(n.t.bind(n,7960,23)),Promise.resolve().then(n.bind(n,9294)),Promise.resolve().then(n.t.bind(n,2972,23))},9294:function(t,e,n){"use strict";n.d(e,{Providers:function(){return l}});var o=n(7437);n(2265);var r=n(5336);function l(t){let{children:e}=t;return(0,o.jsx)(r.H,{children:e})}},9116:function(t,e,n){"use strict";n.d(e,{h:function(){return l}});let o="http://localhost:8000".replace(/\/+$/,"")||"http://localhost:8000";async function r(t,e,n,r){if(!o)throw Error("API base not set");let l=e.startsWith("/")?e:"/".concat(e),a="".concat(o).concat(l),s={"Content-Type":"application/json"};r&&(s.Authorization="Bearer ".concat(r)),console.log("[api:web] ".concat(t," ").concat(a),null!=n?n:"");let i=await fetch(a,{method:t,headers:s,body:n?JSON.stringify(n):void 0,cache:"no-store"}),u=(i.headers.get("content-type")||"").includes("application/json"),c=null;if(u)c=await i.json().catch(()=>null);else{let t=await i.text().catch(()=>"");c=t?{message:t}:null}if(!i.ok){let e=c||{status:i.status};throw console.error("[api:web] ".concat(t," ").concat(l," failed"),{status:i.status,headers:Object.fromEntries(i.headers.entries()),body:e}),Error(("string"==typeof e?e:(null==e?void 0:e.detail)||(null==e?void 0:e.message)||JSON.stringify(e))||"Request failed")}return c}let l={get:(t,e)=>r("GET",t,void 0,e),post:(t,e,n)=>r("POST",t,e,n)}},5336:function(t,e,n){"use strict";n.d(e,{H:function(){return i},a:function(){return u}});var o=n(7437),r=n(2265),l=n(9116);let a=(0,r.createContext)(void 0),s="taskup_auth_v2";function i(t){let{children:e}=t,[n,i]=(0,r.useState)(null),[u,c]=(0,r.useState)(null),[h,f]=(0,r.useState)(!0);(0,r.useEffect)(()=>{try{let t=localStorage.getItem(s),e=null;t&&(e=JSON.parse(t),i(e.user),c(e.token)),(null==e?void 0:e.token)&&l.h.get("/api/auth/me",e.token).then(t=>{(null==t?void 0:t.user)&&d(t.user,e.token)}).catch(()=>{})}catch(t){}finally{f(!1)}},[]);let d=(t,e)=>{i(t),c(e),e?localStorage.setItem(s,JSON.stringify({user:t,token:e})):localStorage.removeItem(s)},g=async(t,e)=>{f(!0);try{var n;let o=await l.h.post("/api/auth/login",{email:t,password:e});return d(null!==(n=o.user)&&void 0!==n?n:o,o.access_token||o.token||null),{ok:!0}}catch(t){return console.error(t),{ok:!1,message:(null==t?void 0:t.message)||"Login failed"}}finally{f(!1)}},v=async function(t,e,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"client";f(!0);try{var r;let a=await l.h.post("/api/auth/register",{full_name:t,email:e,password:n,role:o,language:"en"});return d(null!==(r=a.user)&&void 0!==r?r:a,a.access_token||a.token||null),{ok:!0}}catch(t){return console.error(t),{ok:!1,message:(null==t?void 0:t.message)||"Signup failed"}}finally{f(!1)}};return(0,o.jsx)(a.Provider,{value:{user:n,token:u,loading:h,login:g,register:v,logout:()=>d(null,null)},children:e})}function u(){let t=(0,r.useContext)(a);if(!t)throw Error("useAuth must be used within AuthProvider");return t}},7960:function(){}},function(t){t.O(0,[587,972,971,117,744],function(){return t(t.s=1559)}),_N_E=t.O()}]);