(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12],{5640:function(e,t,s){Promise.resolve().then(s.bind(s,1685))},1685:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var a=s(7437),r=s(2265),l=s(1425),n=s(155),i=s(9820),o=s(2381),c=s(279),d=s(9116),u=s(5336);function h(e){var t,s,h;let{params:f}=e,{token:x,user:p}=(0,u.a)(),{id:m}=f,[g,b]=(0,r.useState)(null),[v,w]=(0,r.useState)([]),[j,y]=(0,r.useState)([]),[N,k]=(0,r.useState)([]),[_,S]=(0,r.useState)([]),[C,O]=(0,r.useState)(""),[E,F]=(0,r.useState)(""),Z=()=>{x&&(d.h.get("/api/tasks/".concat(m),x).then(b).catch(console.error),d.h.get("/api/offers?task_id=".concat(m),x).then(w).catch(console.error),d.h.get("/api/messages?task_id=".concat(m),x).then(y).catch(console.error),d.h.get("/api/payments",x).then(e=>k((e||[]).filter(e=>e.task_id===m))).catch(console.error),d.h.get("/api/disputes",x).then(e=>S((e||[]).filter(e=>e.task_id===m))).catch(console.error))};(0,r.useEffect)(()=>{Z()},[x,m]);let z=async()=>{var e;x&&p&&C&&(await d.h.post("/api/messages",{task_id:m,sender_id:p.id,recipient_id:(null===(e=v[0])||void 0===e?void 0:e.tasker_id)||"unknown",body:C},x),O(""),Z())},I=async()=>{x&&(await d.h.post("/api/tasks/".concat(m,"/mark-done"),{},x).catch(console.error),Z())},P=async()=>{x&&(await d.h.post("/api/tasks/".concat(m,"/confirm-received"),{},x).catch(console.error),Z())},A=async()=>{var e;if(!x||!E)return;let t=null===(e=N[0])||void 0===e?void 0:e.id;await d.h.post("/api/disputes",{task_id:m,payment_id:t,opened_by:null==p?void 0:p.id,reason:E},x),F(""),Z()};return(0,a.jsx)(l.Protected,{children:(0,a.jsx)(n.r,{title:"Order #".concat(m),subtitle:"Chat with the tasker, follow the status, confirm or dispute.",actions:(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsx)(o.z,{variant:"outline",onClick:I,children:"Mark as done (tasker)"}),(0,a.jsx)(o.z,{onClick:P,children:"Mark as received"}),(0,a.jsx)(o.z,{variant:"outline",onClick:A,children:"Open dispute"})]}),children:(0,a.jsxs)("div",{className:"grid lg:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-3",children:[(0,a.jsxs)(i.Z,{className:"p-4 bg-white/5 border-white/10 text-gray-200 text-sm h-72",children:[(0,a.jsx)("div",{className:"font-semibold text-white mb-2",children:"Chat"}),(0,a.jsxs)("div",{className:"space-y-2 overflow-y-auto h-56 pr-2",children:[j.map(e=>(0,a.jsx)("div",{className:"p-3 rounded-lg ".concat(e.sender_id===(null==p?void 0:p.id)?"bg-purple-600/30 ml-6":"bg-white/5"),children:e.body},e.id)),0===j.length?(0,a.jsx)("div",{className:"text-gray-400",children:"No messages yet."}):null]})]}),(0,a.jsxs)(i.Z,{className:"p-4 bg-white/5 border-white/10 text-sm text-gray-200 space-y-3",children:[(0,a.jsx)("p",{className:"font-semibold text-white",children:"Compose"}),(0,a.jsx)(c.I,{value:C,onChange:e=>O(e.target.value),placeholder:"Send a message"}),(0,a.jsx)(o.z,{onClick:z,disabled:!C,children:"Send"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(i.Z,{className:"p-4 bg-white/5 border-white/10 text-gray-200 text-sm",children:[(0,a.jsx)("h3",{className:"text-white font-semibold mb-2",children:"Order details"}),(0,a.jsxs)("p",{children:["Task: ",null!==(s=null==g?void 0:g.title)&&void 0!==s?s:"Loading..."]}),(0,a.jsxs)("p",{children:["Total: ",(null===(t=v[0])||void 0===t?void 0:t.amount_cents)?"".concat((v[0].amount_cents/100).toFixed(0)," kr"):"-"]}),(0,a.jsxs)("p",{children:["Status: ",null!==(h=null==g?void 0:g.status)&&void 0!==h?h:"-"]}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:"Escrowed via Stripe Connect"})]}),(0,a.jsxs)(i.Z,{className:"p-4 bg-white/5 border-white/10 text-gray-200 text-sm",children:[(0,a.jsx)("h3",{className:"text-white font-semibold mb-2",children:"Offers"}),(0,a.jsxs)("ul",{className:"space-y-2",children:[v.map(e=>(0,a.jsxs)("li",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{children:[(e.amount_cents/100).toFixed(0)," kr"]}),(0,a.jsx)("span",{className:"text-gray-400 text-xs",children:e.status})]},e.id)),0===v.length?(0,a.jsx)("div",{className:"text-gray-400 text-sm",children:"No offers yet."}):null]})]}),(0,a.jsxs)(i.Z,{className:"p-4 bg-white/5 border-white/10 text-gray-200 text-sm space-y-2",children:[(0,a.jsx)("h3",{className:"text-white font-semibold",children:"Dispute"}),(0,a.jsx)(c.I,{value:E,onChange:e=>F(e.target.value),placeholder:"Reason"}),(0,a.jsx)(o.z,{variant:"outline",onClick:A,disabled:!E,children:"Submit dispute"}),(0,a.jsx)("div",{className:"text-xs text-gray-400",children:_.map(e=>(0,a.jsxs)("div",{children:[e.reason," â€“ ",e.status]},e.id))})]})]})]})})})}},1425:function(e,t,s){"use strict";s.d(t,{Protected:function(){return i}});var a=s(7437),r=s(2265),l=s(5475),n=s(5336);function i(e){let{children:t,role:s}=e,{token:i,loading:o,user:c}=(0,n.a)(),d=(0,l.useRouter)();return((0,r.useEffect)(()=>{o||i?!o&&s&&(null==c?void 0:c.role)!==s&&"admin"===s&&d.replace("/dashboard"):d.replace("/auth/login")},[o,i,d,s,null==c?void 0:c.role]),o||!i)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center text-white",children:"Loading..."}):(0,a.jsx)(a.Fragment,{children:t})}},9116:function(e,t,s){"use strict";s.d(t,{h:function(){return l}});let a="http://localhost:8000".replace(/\/+$/,"")||"http://localhost:8000";async function r(e,t,s,r){if(!a)throw Error("API base not set");let l=t.startsWith("/")?t:"/".concat(t),n="".concat(a).concat(l),i={"Content-Type":"application/json"};r&&(i.Authorization="Bearer ".concat(r)),console.log("[api:web] ".concat(e," ").concat(n),null!=s?s:"");let o=await fetch(n,{method:e,headers:i,body:s?JSON.stringify(s):void 0,cache:"no-store"}),c=(o.headers.get("content-type")||"").includes("application/json"),d=null;if(c)d=await o.json().catch(()=>null);else{let e=await o.text().catch(()=>"");d=e?{message:e}:null}if(!o.ok){let t=d||{status:o.status};throw console.error("[api:web] ".concat(e," ").concat(l," failed"),{status:o.status,headers:Object.fromEntries(o.headers.entries()),body:t}),Error(("string"==typeof t?t:(null==t?void 0:t.detail)||(null==t?void 0:t.message)||JSON.stringify(t))||"Request failed")}return d}let l={get:(e,t)=>r("GET",e,void 0,t),post:(e,t,s)=>r("POST",e,t,s)}},5336:function(e,t,s){"use strict";s.d(t,{H:function(){return o},a:function(){return c}});var a=s(7437),r=s(2265),l=s(9116);let n=(0,r.createContext)(void 0),i="taskup_auth_v2";function o(e){let{children:t}=e,[s,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),[u,h]=(0,r.useState)(!0);(0,r.useEffect)(()=>{try{let e=localStorage.getItem(i),t=null;e&&(t=JSON.parse(e),o(t.user),d(t.token)),(null==t?void 0:t.token)&&l.h.get("/api/auth/me",t.token).then(e=>{(null==e?void 0:e.user)&&f(e.user,t.token)}).catch(()=>{})}catch(e){}finally{h(!1)}},[]);let f=(e,t)=>{o(e),d(t),t?localStorage.setItem(i,JSON.stringify({user:e,token:t})):localStorage.removeItem(i)},x=async(e,t)=>{h(!0);try{var s;let a=await l.h.post("/api/auth/login",{email:e,password:t});return f(null!==(s=a.user)&&void 0!==s?s:a,a.access_token||a.token||null),{ok:!0}}catch(e){return console.error(e),{ok:!1,message:(null==e?void 0:e.message)||"Login failed"}}finally{h(!1)}},p=async function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"client";h(!0);try{var r;let n=await l.h.post("/api/auth/register",{full_name:e,email:t,password:s,role:a,language:"en"});return f(null!==(r=n.user)&&void 0!==r?r:n,n.access_token||n.token||null),{ok:!0}}catch(e){return console.error(e),{ok:!1,message:(null==e?void 0:e.message)||"Signup failed"}}finally{h(!1)}};return(0,a.jsx)(n.Provider,{value:{user:s,token:c,loading:u,login:x,register:p,logout:()=>f(null,null)},children:t})}function c(){let e=(0,r.useContext)(n);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},7648:function(e,t,s){"use strict";s.d(t,{default:function(){return r.a}});var a=s(2972),r=s.n(a)},155:function(e,t,s){"use strict";s.d(t,{r:function(){return d}});var a=s(7437),r=s(7648);s(2265);var l=s(2381),n=s(9820),i=s(1994);let o=e=>{let{className:t,children:s,...r}=e;return(0,a.jsx)("div",{className:(0,i.Z)("inline-flex items-center rounded-full border border-white/15 bg-white/10 px-3 py-1 text-xs font-semibold text-white",t),...r,children:s})},c={client:[{href:"/dashboard",label:"Overview"},{href:"/tasks",label:"Tasks"},{href:"/messages",label:"Messages"},{href:"/wallet",label:"Wallet"},{href:"/settings",label:"Settings"}],tasker:[{href:"/tasker",label:"Overview"},{href:"/tasker/tasks",label:"Nearby tasks"},{href:"/tasker/offers",label:"Offers"},{href:"/tasker/wallet",label:"Earnings"},{href:"/tasker/settings",label:"Settings"}],admin:[{href:"/admin",label:"Dashboard"},{href:"/admin/users",label:"Users"},{href:"/admin/tasks",label:"Tasks"},{href:"/admin/offers",label:"Offers"},{href:"/admin/disputes",label:"Disputes"},{href:"/admin/payments",label:"Payments"},{href:"/admin/reports",label:"Reports"},{href:"/admin/logs",label:"Logs"},{href:"/admin/analytics",label:"Analytics"}]};function d(e){let{title:t,subtitle:s,variant:i="client",actions:d,children:u}=e,h=c[i];return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,a.jsx)("div",{className:"absolute -top-10 left-10 w-64 h-64 rounded-full bg-[#8B5CFF]/15 blur-3xl"}),(0,a.jsx)("div",{className:"absolute bottom-0 right-10 w-72 h-72 rounded-full bg-[#24c0f7]/12 blur-3xl"})]}),(0,a.jsx)("div",{className:"relative max-w-7xl mx-auto px-4 lg:px-8 py-10",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6",children:[(0,a.jsxs)("aside",{className:"w-full lg:w-64 space-y-4",children:[(0,a.jsxs)(n.Z,{className:"p-4 glass",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-400 font-semibold mb-2 uppercase tracking-wide",children:[i," menu"]}),(0,a.jsx)("div",{className:"space-y-2",children:h.map(e=>(0,a.jsxs)(r.default,{href:e.href,className:"flex items-center justify-between px-3 py-2 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 text-sm font-semibold shadow-[0_10px_30px_rgba(0,0,0,0.35)]",children:[(0,a.jsx)("span",{children:e.label}),(0,a.jsx)(o,{className:"bg-[#8B5CFF]/20 text-purple-100 border-[#8B5CFF]/40",children:"Go"})]},e.href))})]}),(0,a.jsxs)(n.Z,{className:"p-4 bg-gradient-to-br from-[#8B5CFF]/30 to-[#24c0f7]/20 border-white/10 shadow-[0_20px_50px_rgba(0,0,0,0.35)]",children:[(0,a.jsx)("div",{className:"text-lg font-bold mb-2",children:"Need help?"}),(0,a.jsx)("p",{className:"text-sm text-gray-200 mb-3",children:"Chat with support or open a dispute from any order room."}),(0,a.jsx)(l.z,{variant:"outline",size:"sm",asChild:!0,children:(0,a.jsx)(r.default,{href:"/messages",children:"Open chat"})})]})]}),(0,a.jsxs)("section",{className:"flex-1 space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-black text-white",children:t}),s?(0,a.jsx)("p",{className:"text-gray-300",children:s}):null]}),d]}),u]})]})})]})}},2381:function(e,t,s){"use strict";s.d(t,{z:function(){return n}});var a=s(7437),r=s(2265),l=s(1994);let n=e=>{let{children:t,className:s,variant:n="solid",size:i="md",asChild:o=!1,...c}=e,d=(0,l.Z)("inline-flex items-center justify-center rounded-xl font-semibold transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[#0b0c15]",{solid:"bg-gradient-to-r from-[#8B5CFF] to-[#24c0f7] text-white shadow-[0_10px_40px_rgba(139,92,255,0.35)] hover:brightness-110",outline:"border border-white/20 text-white bg-white/5 hover:border-white/40 hover:bg-white/10 backdrop-blur",ghost:"text-white hover:bg-white/5"}[n],{sm:"px-3 py-2 text-sm",md:"px-4 py-2",lg:"px-5 py-3 text-lg"}[i],s);if(o&&r.isValidElement(t)){var u;return r.cloneElement(t,{className:(0,l.Z)(d,null===(u=t.props)||void 0===u?void 0:u.className)})}return(0,a.jsx)("button",{className:d,...c,children:t})}},9820:function(e,t,s){"use strict";s.d(t,{Z:function(){return l}});var a=s(7437);s(2265);var r=s(1994);let l=e=>{let{className:t,children:s,...l}=e;return(0,a.jsx)("div",{className:(0,r.Z)("glass rounded-2xl border border-white/10 bg-white/5 backdrop-blur-xl shadow-lg shadow-purple-500/10",t),...l,children:s})}},279:function(e,t,s){"use strict";s.d(t,{I:function(){return n}});var a=s(7437),r=s(2265),l=s(1994);let n=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("input",{ref:t,className:(0,l.Z)("w-full rounded-xl bg-white/5 border border-white/15 px-3 py-2 text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-[#8B5CFF]/60 shadow-[0_10px_30px_rgba(0,0,0,0.35)] backdrop-blur",s),...r})});n.displayName="Input"},1994:function(e,t,s){"use strict";t.Z=function(){for(var e,t,s=0,a="",r=arguments.length;s<r;s++)(e=arguments[s])&&(t=function e(t){var s,a,r="";if("string"==typeof t||"number"==typeof t)r+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(s=0;s<l;s++)t[s]&&(a=e(t[s]))&&(r&&(r+=" "),r+=a)}else for(a in t)t[a]&&(r&&(r+=" "),r+=a)}return r}(e))&&(a&&(a+=" "),a+=t);return a}}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=5640)}),_N_E=e.O()}]);