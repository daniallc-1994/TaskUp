(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[564,757,668,375,938,913],{157:function(e,t,n){Promise.resolve().then(n.bind(n,1425)),Promise.resolve().then(n.t.bind(n,2972,23))},1425:function(e,t,n){"use strict";n.d(t,{Protected:function(){return s}});var o=n(7437),r=n(2265),l=n(5475),a=n(5336);function s(e){let{children:t,role:n}=e,{token:s,loading:i,user:u}=(0,a.a)(),c=(0,l.useRouter)();return((0,r.useEffect)(()=>{i||s?!i&&n&&(null==u?void 0:u.role)!==n&&"admin"===n&&c.replace("/dashboard"):c.replace("/auth/login")},[i,s,c,n,null==u?void 0:u.role]),i||!s)?(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center text-white",children:"Loading..."}):(0,o.jsx)(o.Fragment,{children:t})}},9116:function(e,t,n){"use strict";n.d(t,{h:function(){return l}});let o="http://localhost:8000".replace(/\/+$/,"")||"http://localhost:8000";async function r(e,t,n,r){if(!o)throw Error("API base not set");let l=t.startsWith("/")?t:"/".concat(t),a="".concat(o).concat(l),s={"Content-Type":"application/json"};r&&(s.Authorization="Bearer ".concat(r)),console.log("[api:web] ".concat(e," ").concat(a),null!=n?n:"");let i=await fetch(a,{method:e,headers:s,body:n?JSON.stringify(n):void 0,cache:"no-store"}),u=(i.headers.get("content-type")||"").includes("application/json"),c=null;if(u)c=await i.json().catch(()=>null);else{let e=await i.text().catch(()=>"");c=e?{message:e}:null}if(!i.ok){let t=c||{status:i.status};throw console.error("[api:web] ".concat(e," ").concat(l," failed"),{status:i.status,headers:Object.fromEntries(i.headers.entries()),body:t}),Error(("string"==typeof t?t:(null==t?void 0:t.detail)||(null==t?void 0:t.message)||JSON.stringify(t))||"Request failed")}return c}let l={get:(e,t)=>r("GET",e,void 0,t),post:(e,t,n)=>r("POST",e,t,n)}},5336:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return u}});var o=n(7437),r=n(2265),l=n(9116);let a=(0,r.createContext)(void 0),s="taskup_auth_v2";function i(e){let{children:t}=e,[n,i]=(0,r.useState)(null),[u,c]=(0,r.useState)(null),[h,d]=(0,r.useState)(!0);(0,r.useEffect)(()=>{try{let e=localStorage.getItem(s),t=null;e&&(t=JSON.parse(e),i(t.user),c(t.token)),(null==t?void 0:t.token)&&l.h.get("/api/auth/me",t.token).then(e=>{(null==e?void 0:e.user)&&f(e.user,t.token)}).catch(()=>{})}catch(e){}finally{d(!1)}},[]);let f=(e,t)=>{i(e),c(t),t?localStorage.setItem(s,JSON.stringify({user:e,token:t})):localStorage.removeItem(s)},g=async(e,t)=>{d(!0);try{var n;let o=await l.h.post("/api/auth/login",{email:e,password:t});return f(null!==(n=o.user)&&void 0!==n?n:o,o.access_token||o.token||null),{ok:!0}}catch(e){return console.error(e),{ok:!1,message:(null==e?void 0:e.message)||"Login failed"}}finally{d(!1)}},p=async function(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"client";d(!0);try{var r;let a=await l.h.post("/api/auth/register",{full_name:e,email:t,password:n,role:o,language:"en"});return f(null!==(r=a.user)&&void 0!==r?r:a,a.access_token||a.token||null),{ok:!0}}catch(e){return console.error(e),{ok:!1,message:(null==e?void 0:e.message)||"Signup failed"}}finally{d(!1)}};return(0,o.jsx)(a.Provider,{value:{user:n,token:u,loading:h,login:g,register:p,logout:()=>f(null,null)},children:t})}function u(){let e=(0,r.useContext)(a);if(!e)throw Error("useAuth must be used within AuthProvider");return e}}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=157)}),_N_E=e.O()}]);